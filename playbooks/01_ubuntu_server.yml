---
- name: Provision New Ubuntu 24.04 Server
  hosts: all
  become: true
  vars_files:
    - group_vars/all.yml

  roles:
    - role: time_sync
    - role: network_security
    - role: ssh_hardening
    - role: file_integrity_audit
    - role: auth_access
    - role: crypto_fips
    - role: logging_journal
    - role: system_hardening
    - role: session_timeouts
    - role: packages_patching
    - role: compliance_lockdown

    # OLD ROLES TO POTENTIALLY KEEP
    #- role: users               # Create admin user and SSH keypair
    #- role: common              # Update apt cach and packages, and set timezone
    #- role: packages            # Install essential packages

    
    # OLD ROLES, TO BE REMOVED
    #- role: ubuntu_pro_attach   # Attach Ubuntu Pro if not already, and enable USG
    #  vars:
    #    ubuntu_pro_token: "{{ ubuntu_pro_token }}"
    #- role: ssh                 # Harden SSH configuration
    #- role: hardening       # Apply full STIG controls
    #- role: firewall        # Install UFW and configure default rules.
    #- role: ssh             # Harden SSH implementation if not doone during provisioning.
