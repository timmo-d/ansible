---
# This task is part of Ubuntu 24.04 LTS DISA-STIG baseline

- name: Get current sudo group members
  shell: "getent group sudo | cut -d: -f4"
  register: sudo_members
  changed_when: false

- name: Remove unauthorized sudo users
  user:
    name: "{{ item }}"
    groups: "{{ (item in approved_sudo_users) | ternary('sudo','') }}"
    append: no
  loop: "{{ sudo_members.stdout.split(',') if sudo_members.stdout else [] }}"
  when: item and (item not in approved_sudo_users)
