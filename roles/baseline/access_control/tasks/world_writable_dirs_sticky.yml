---
# This task is part of Ubuntu 24.04 LTS DISA-STIG baseline

- name: Find local world-writable directories
  shell: |
    df --local -P | awk 'NR!=1 {print $6}' | xargs -I '{}' find '{}' -xdev -type d -perm -0002
  register: wwd
  changed_when: false

- name: Set sticky bit on world-writable directories
  file:
    path: "{{ item }}"
    mode: a+t
  loop: "{{ wwd.stdout_lines }}"
  when: wwd.stdout | length > 0
