---
# This task is part of Ubuntu 24.04 LTS DISA-STIG baseline

- name: Deploy hardened GRUB defaults
  template:
    src: "{{ role_path }}/system_config/templates/grub.j2"
    dest: /etc/default/grub
    owner: root
    group: root
    mode: '0644'

- name: Configure bootloader password if provided
  blockinfile:
    path: /etc/grub.d/40_custom
    create: yes
    block: |
      set superusers="root"
      password_pbkdf2 root {{ bootloader_password_pbkdf2 }}
  when: bootloader_password_pbkdf2 | length > 0

- name: Update grub
  command: update-grub
