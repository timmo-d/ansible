---

- name: Apply kernel/sysctl hardening settings
  template:
    src: "{{ role_path }}/system_config/templates/sysctl-hardening.conf.j2"
    dest: /etc/sysctl.d/99-stig-hardening.conf
    owner: root
    group: root
    mode: '0644'

- name: Reload sysctl settings
  command: sysctl --system

- name: "SYSCTL | CIS networking hardening"
  sysctl:
    name: "{{ item.key }}"
    value: "{{ item.value }}"
    state: present
    reload: yes
  loop: "{{ sysctl_params | dict2items }}"
  vars:
    sysctl_params:
      net.ipv6.conf.all.accept_ra: 0
      net.ipv6.conf.default.accept_ra: 0
      net.ipv6.conf.all.forwarding: 0
      net.ipv4.conf.all.log_martians: 1
      net.ipv4.conf.default.log_martians: 1
      net.ipv4.conf.all.rp_filter: 1
      net.ipv4.conf.default.rp_filter: 1
      net.ipv4.conf.all.accept_redirects: 0
      net.ipv4.conf.default.accept_redirects: 0
      net.ipv4.conf.all.secure_redirects: 0
      net.ipv4.conf.default.secure_redirects: 0
      net.ipv4.tcp_syncookies: 1
